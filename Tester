-- Script to toggle the visibility of the frame at "game:GetService(\"CoreGui\").SimpleSpy2.Background"
local coreGui = game:GetService("CoreGui")

-- Check for duplicate toggle buttons and destroy if found
local existingButton = coreGui:FindFirstChild("ToggleButton")
if existingButton then
    existingButton:Destroy()
end

local toggleButton = Instance.new("TextButton")
toggleButton.Name = "ToggleButton"

-- Parent the toggle button to CoreGui
toggleButton.Parent = coreGui

-- Set up the toggle button properties
toggleButton.Size = UDim2.new(0, 32, 0, 32)
toggleButton.Position = UDim2.new(0.5, -16, 0.8, -16)
toggleButton.Text = ""
toggleButton.BackgroundColor3 = Color3.fromRGB(37, 35, 38)
toggleButton.TextColor3 = Color3.fromRGB(255, 255, 255)
toggleButton.Font = Enum.Font.GothamBold

-- Create UICorner for the toggle button
local uiCorner = Instance.new("UICorner")
uiCorner.CornerRadius = UDim.new(0, 8)
uiCorner.Parent = toggleButton

-- Function to check the visibility of the Background frame
local function updateButtonText()
    local backgroundFrame = coreGui:FindFirstChild("SimpleSpy2")
    if backgroundFrame and backgroundFrame:FindFirstChild("Background") then
        local frame = backgroundFrame.Background
        if frame.Visible then
            toggleButton.Text = "C"
        else
            toggleButton.Text = "O"
        end
    else
        warn("Background frame not found!")
    end
end

-- Initial update of the button text
updateButtonText()

-- Function to toggle the visibility of the Background frame
local function toggleVisibility()
    local backgroundFrame = coreGui:FindFirstChild("SimpleSpy2")
    if backgroundFrame and backgroundFrame:FindFirstChild("Background") then
        local frame = backgroundFrame.Background
        frame.Visible = not frame.Visible
        updateButtonText()
    else
        warn("Background frame not found!")
    end
end

-- Connect the button click to toggle the visibility of the Background frame
toggleButton.MouseButton1Click:Connect(toggleVisibility)

-- Make the button draggable on Android devices
local userInputService = game:GetService("UserInputService")
local dragging = false
local dragInput, dragStart, startPos

local function updateInput(input)
    local delta = input.Position - dragStart
    toggleButton.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
end

toggleButton.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.Touch or input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = true
        dragStart = input.Position
        startPos = toggleButton.Position
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)

toggleButton.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.Touch or input.UserInputType == Enum.UserInputType.MouseMovement then
        dragInput = input
    end
end)

userInputService.InputChanged:Connect(function(input)
    if dragging and input == dragInput then
        updateInput(input)
    end
end)

-- Make the Background frame draggable on Android devices
local function makeBackgroundDraggable()
    local backgroundFrame = coreGui:FindFirstChild("SimpleSpy2")
    if backgroundFrame and backgroundFrame:FindFirstChild("Background") then
        local frame = backgroundFrame.Background
        local draggingBg = false
        local dragBgInput, dragBgStart, startBgPos

        local function updateBgInput(input)
            local delta = input.Position - dragBgStart
            frame.Position = UDim2.new(startBgPos.X.Scale, startBgPos.X.Offset + delta.X, startBgPos.Y.Scale, startBgPos.Y.Offset + delta.Y)
        end

        frame.InputBegan:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.Touch or input.UserInputType == Enum.UserInputType.MouseButton1 then
                draggingBg = true
                dragBgStart = input.Position
                startBgPos = frame.Position
                input.Changed:Connect(function()
                    if input.UserInputState == Enum.UserInputState.End then
                        draggingBg = false
                    end
                end)
            end
        end)

        frame.InputChanged:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.Touch or input.UserInputType == Enum.UserInputType.MouseMovement then
                dragBgInput = input
            end
        end)

        userInputService.InputChanged:Connect(function(input)
            if draggingBg and input == dragBgInput then
                updateBgInput(input)
            end
        end)
    else
        warn("Background frame not found!")
    end
end

makeBackgroundDraggable()

-- Destroy the Cursor frame if it exists
local function destroyCursorFrame()
    local cursorFrame = coreGui:FindFirstChild("SimpleSpy2")
    if cursorFrame and cursorFrame:FindFirstChild("Cursor") then
        cursorFrame.Cursor:Destroy()
    end
end

game:GetService("RunService").RenderStepped:Connect(destroyCursorFrame)
